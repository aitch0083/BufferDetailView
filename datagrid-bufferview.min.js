$.extend($.fn.datagrid.defaults,{onBeforeFetch:function(a){},onFetch:function(b,a){}});var bufferview=$.extend({},$.fn.datagrid.defaults.view,{onAfterRender:function(a){},render:function(m,e,a){var d=$.data(m,"datagrid");var b=d.options;var q=this.rows||[];if(!q.length){return}var k=$(m).datagrid("getColumnFields",a);if(a){if(!(b.rownumbers||(b.frozenColumns&&b.frozenColumns.length))){return}}var l=parseInt(b.finder.getTr(m,"","last",(a?1:2)).attr("datagrid-row-index"))+1||0;if(l>=d.data.total){return}var o=['<table class="datagrid-btable" cellspacing="0" cellpadding="0" border="0"><tbody>'];for(var h=0;h<q.length;h++){var j=b.rowStyler?b.rowStyler.call(m,l,q[h]):"";var f="";var p="";if(typeof j=="string"){p=j}else{if(j){f=j["class"]||"";p=j.style||""}}var n='class="datagrid-row '+(l%2&&b.striped?"datagrid-row-alt ":" ")+f+'"';var c=p?'style="'+p+'"':"";var g=d.rowIdPrefix+"-"+(a?1:2)+"-"+l;o.push('<tr id="'+g+'" datagrid-row-index="'+l+'" '+n+" "+c+">");o.push(this.renderRow.call(this,m,k,a,l,q[h]));o.push("</tr>");if(b.detailFormatter){o.push('<tr style="display:none;">');if(a){o.push("<td colspan="+(k.length+2)+' style="border-right:0">')}else{o.push("<td colspan="+(k.length)+">")}o.push('<div class="datagrid-row-detail">');if(a){o.push("&nbsp;")}else{o.push(b.detailFormatter.call(m,l,q[h]))}o.push("</div>");o.push("</td>");o.push("</tr>")}l++}o.push("</tbody></table>");$(e).append(o.join(""))},renderRow:function(t,q,s,h,f){var o=$.data(t,"datagrid").options,p=[],j=typeof o.columns[0]["rowSpanField"]!=="undefined"?o.columns[0]["rowSpanField"]:"",b=j!==""&&typeof f[j]["numRows"]!=="undefined"?f[j]["numRows"]:1;if(s&&o.rownumbers){var k=h+1;if(o.pagination){k+=(o.pageNumber-1)*o.pageSize}p.push('<td class="datagrid-td-rownumber"><div class="datagrid-cell-rownumber">'+k+"</div></td>")}for(var r=0;r<q.length;r++){var g=q[r];var c=$(t).datagrid("getColumnOption",g);if(c){var e=f[g];var l=c.styler?(c.styler(e,f,h)||""):"";var d="";var n="";if(typeof l=="string"){n=l}else{if(l){d=l["class"]||"";n=l.style||""}}var a=d?'class="'+d+(s?"frozen-td":"")+'"':(s?'class="frozen-td"':"");var m=c.hidden?'style="display:none;'+n+'"':(n?'style="'+n+'"':"");p.push('<td field="'+g+'" '+a+" "+m+">");var m="";if(!c.checkbox){if(c.align){m+="text-align:"+c.align+";"}else{if(c.expander){style="text-align:center;height:16px;"}}if(!o.nowrap){m+="white-space:normal;height:auto;"}else{if(o.autoRowHeight){m+="height:auto;"}}}p.push('<div style="'+m+'" ');p.push(c.checkbox?'class="datagrid-cell-check"':'class="datagrid-cell '+c.cellClass+'"');p.push(">");if(c.checkbox){p.push('<input type="checkbox" '+(f.checked?'checked="checked"':""));p.push(' name="'+g+'" value="'+(e!=undefined?e:"")+'">')}else{if(c.expander){p.push('<span class="datagrid-row-expander datagrid-row-expand" style="display:inline-block;width:16px;height:16px;cursor:pointer;" />')}else{if(c.formatter){p.push(c.formatter(e,f,h))}else{p.push(e)}}}p.push("</div>");p.push("</td>")}}return p.join("")},bindEvents:function(e){var d=$.data(e,"datagrid");var b=d.dc;var c=d.options;var a=b.body1.add(b.body2);var f=($.data(a[0],"events")||$._data(a[0],"events")).click[0].handler;a.unbind("click").bind("click",function(i){var g=$(i.target);var h=g.closest("tr.datagrid-row");if(!h.length){return}if(g.hasClass("datagrid-row-expander")){var j=parseInt(h.attr("datagrid-row-index"));if(g.hasClass("datagrid-row-expand")){$(e).datagrid("expandRow",j)}else{$(e).datagrid("collapseRow",j)}$(e).datagrid("fixRowHeight")}else{f(i)}i.stopPropagation()})},onBeforeRender:function(f){var b=$.data(f,"datagrid");var a=b.options;var h=b.dc;var g=this;this.renderedCount=0;this.rows=[];h.body1.add(h.body2).empty();i();c();function i(){b.onLoadSuccess=a.onLoadSuccess;a.onLoadSuccess=function(){};setTimeout(function(){h.body2.unbind(".datagrid").bind("scroll.datagrid",function(j){if(b.onLoadSuccess){a.onLoadSuccess=b.onLoadSuccess;b.onLoadSuccess=undefined}if(g.scrollTimer){clearTimeout(g.scrollTimer)}g.scrollTimer=setTimeout(function(){e.call(g)},50)});h.body2.triggerHandler("scroll.datagrid")},0)}function e(){if(d()<h.body2.height()&&g.renderedCount<b.data.total){this.getRows.call(this,f,function(j){this.rows=j;this.populate.call(this,f);h.body2.triggerHandler("scroll.datagrid")})}else{if(h.body2.scrollTop()>=d()-h.body2.height()){this.getRows.call(this,f,function(j){this.rows=j;this.populate.call(this,f)})}}}function d(){var j=0;h.body2.children("table.datagrid-btable").each(function(){j+=$(this).outerHeight()});if(!j){j=g.renderedCount*25}return j}function c(){if(!a.detailFormatter){return}var m=$(f);var n=false;var j=m.datagrid("getColumnFields",true).concat(m.datagrid("getColumnFields"));for(var l=0;l<j.length;l++){var k=m.datagrid("getColumnOption",j[l]);if(k.expander){n=true;break}}if(!n){if(a.frozenColumns&&a.frozenColumns.length){a.frozenColumns[0].splice(0,0,{field:"_expander",expander:true,width:24,resizable:false,fixed:true})}else{a.frozenColumns=[[{field:"_expander",expander:true,width:24,resizable:false,fixed:true}]]}var m=h.view1.children("div.datagrid-header").find("table");var o=$('<td rowspan="'+a.frozenColumns.length+'"><div class="datagrid-header-expander" style="width:24px;"></div></td>');if($("tr",m).length==0){o.wrap("<tr></tr>").parent().appendTo($("tbody",m))}else{if(a.rownumbers){o.insertAfter(m.find("td:has(div.datagrid-header-rownumber)"))}else{o.prependTo(m.find("tr:first"))}}}setTimeout(function(){g.bindEvents(f)},0)}},getRows:function(e,g){var b=$.data(e,"datagrid");var a=b.options;var f=Math.floor(this.renderedCount/a.pageSize)+1;if(this.renderedCount>=b.data.total){return}if(a.onBeforeFetch.call(e,f)==false){return}var d=(f-1)*a.pageSize;var i=b.data.rows.slice(d,d+a.pageSize);if(i.length){a.onFetch.call(e,f,i);g.call(this,i)}else{var c=$.extend({},a.queryParams,{page:Math.floor(this.renderedCount/a.pageSize)+1,rows:a.pageSize});if(a.sortName){$.extend(c,{sort:a.sortName,order:a.sortOrder})}if(a.onBeforeLoad.call(e,c)==false){return}$(e).datagrid("loading");var h=a.loader.call(e,c,function(j){$(e).datagrid("loaded");var j=a.loadFilter.call(e,j);a.onFetch.call(e,f,j.rows);if(j.rows&&j.rows.length){b.data.rows=b.data.rows.concat(j.rows);g.call(a.view,j.rows)}else{a.onLoadSuccess.call(e,j)}},function(){$(e).datagrid("loaded");a.onLoadError.apply(e,arguments)});if(h==false){$(e).datagrid("loaded");if(!b.data.rows.length){a.onFetch.call(e,f,b.data.rows);a.onLoadSuccess.call(e,b.data)}}}},populate:function(d){var c=$.data(d,"datagrid");var b=c.options;var a=c.dc;if(this.rows.length){this.renderedCount+=this.rows.length;this.render.call(this,d,a.body2,false);this.render.call(this,d,a.body1,true);b.onLoadSuccess.call(d,{total:c.data.total,rows:this.rows})}}});$.extend($.fn.datagrid.methods,{fixDetailRowHeight:function(b,a){return b.each(function(){var f=$.data(this,"datagrid").options;var e=$.data(this,"datagrid").dc;var d=f.finder.getTr(this,a,"body",1).next();var g=f.finder.getTr(this,a,"body",2).next();if(g.is(":visible")){d.css("height","");g.css("height","");var c=Math.max(d.height(),g.height());d.css("height",c);g.css("height",c)}e.body2.triggerHandler("scroll")})},getExpander:function(c,a){var b=$.data(c[0],"datagrid").options;return b.finder.getTr(c[0],a).find("span.datagrid-row-expander")},getRowDetail:function(d,a){var b=$.data(d[0],"datagrid").options;var c=b.finder.getTr(d[0],a,"body",2);return c.next().find("div.datagrid-row-detail")},expandRow:function(b,a){return b.each(function(){var e=$(this).datagrid("options");var d=$.data(this,"datagrid").dc;var h=$(this).datagrid("getExpander",a);if(h.hasClass("datagrid-row-expand")){h.removeClass("datagrid-row-expand").addClass("datagrid-row-collapse");var c=e.finder.getTr(this,a,"body",1).next();var g=e.finder.getTr(this,a,"body",2).next();c.show();g.show();$(this).datagrid("fixDetailRowHeight",a);if(e.onExpandRow){var f=$(this).datagrid("getRows")[a];e.onExpandRow.call(this,a,f)}}})},collapseRow:function(b,a){return b.each(function(){var e=$(this).datagrid("options");var d=$.data(this,"datagrid").dc;var h=$(this).datagrid("getExpander",a);if(h.hasClass("datagrid-row-collapse")){h.removeClass("datagrid-row-collapse").addClass("datagrid-row-expand");var c=e.finder.getTr(this,a,"body",1).next();var g=e.finder.getTr(this,a,"body",2).next();c.hide();g.hide();d.body2.triggerHandler("scroll");if(e.onCollapseRow){var f=$(this).datagrid("getRows")[a];e.onCollapseRow.call(this,a,f)}}})}});
